;+ 
; NAME:
; wfc3_g280_mkcalibstrct
;
; PURPOSE:
;    Creates a structure for guiding WFC3/G280 data reduction
;  First code in our data reduction pipeline.  In particular, contains
;  hard-coded polynomials for tracing and wavelength solution.
;
; CALLING SEQUENCE:
;   
;   calib_strct = wfc3_g280_mkcalibstrct(chip, AXE1=) 
;
; INPUTS:
;   chip -- which chip's calibration data is wanted
;
; RETURNS:
;
; OUTPUTS:
;   calib_strct -- A structure containing the calibration files
;
; OPTIONAL KEYWORDS:
;   AXE1=  -- Use the first AXE team solution for BeamA (not
;             recommended)
;
; OPTIONAL OUTPUTS:
;
; COMMENTS:
;
; EXAMPLES:
;   wfc3_strct = wfc3_g280_mkcalibstrct(chip, AXE1=axe1) 
;
; PROCEDURES CALLED:
;
; REVISION HISTORY:
;   23-Dec-2010 Written by JXP/JMO
;   10-Jun-2016 Updated with new calibration files by MN
;------------------------------------------------------------------------------

function wfc3_g280_mkcalibstrct, chip, AXE1=axe1 

  ;make the structure
  case chip of   ;; October 2015 value
     1: begin
        struct = { $
                 READNO: 3.3,$
                 BEAMA: [-400L, 215],$
                 DYDX_ORDER_A:6L,$
                 DYDX_A: [[173.93329566558168d,-0.0017745578583666709,0.004094178735199138], $
                          [-0.0037958978799161906d,-1.4395595073604493d-6,-4.9509874353862106d-6],$
                          [0.0003335741958191544d,-1.1591924817665047d-8,-1.2729699153070891d-10],$
                          [2.40209868635139d-6,-6.865066680530258d-11,-3.400404437206059d-11],$
                          [1.0550532737983465d-8,-2.0223735221418172d-13,-2.5330874248205076d-13],$
                          [2.199208773850666d-11,-1.9048302258762925d-16,-6.415473132470955d-16],$
                          [1.7135622752880473d-14,1.369061044996829d-19,-5.680791733691364d-19]],$
                 XOFF_A: -150L,$
                 YOFF_A: 0L,$
                 XOFF_A2: 0L,$
                 YOFF_A2: 0L,$
                 DISP_ORDER_A:4L,$
                 DLDP_A: [[3547.8136743387913d,0.04898603983516115,-0.027071680330018],$
                          [-13.75918635808393d,-0.0002580304290965832,0.0001782486196050317],$
                          [0.005186011738915429d,-4.058373100326685d-7,1.4895162535452872d-7],$
                          [0.000027969319182900263d,1.1703833719297967d-10,-1.6241444481315035d-9],$
                          [4.6081199020831976d-8,3.9091305437750505d-12,-6.227527990849325d-12]],$
                 SENS_FILA: getenv('XIDL_DIR')+'HST/WFC3/G280/wfc3_abscal_UVg280_1st_sensTV3.fits',$
                 BEAMC: [-60L, 560],$
                 DYDX_ORDER_C:6L,$
                 DYDX_C: [[155.14521026107752d,-0.0018553184713251748d,0.0021740743127842276],$
                          [-0.2136299752954201d,0.000010170844562485376,-7.593234122045616d-6],$
                          [0.0019574464696920017d,-1.8308974740898027d-7,1.4107367923443057d-7],$
                          [-0.000013983890925769543d,1.6062356495515166d-9,-2.0651356570273137d-9],$
                          [5.166710217090742d-8,-6.6521985157927385d-12,1.1886091759937449d-11],$
                          [-9.2430276040123d-11,1.2602033887168308d-14,-2.9024952217702314d-14],$
                          [6.375172296830083d-14,-8.78715742636431d-18,2.5210797873773947d-17]],$
                 XOFF_C: 300L,$
                 YOFF_C: 0L,$
                 XOFF_C2: 0L,$
                 YOFF_C2: 0L,$
                 DISP_ORDER_C:4L,$
                 DLDP_C: [[2817.8089949558885d,0.0443421830982831,-0.04402778869937928],$
                          [15.190490747986432d,0.00012359119342888054,-0.00015405540582809457],$
                          [-0.0052390716614667d,6.072315971286371d-7,6.022513884504224d-7],$
                          [0.000016641496204023276d,-2.031030620433549d-9,-4.153379012259047d-9],$
                          [-1.9858539127727196d-8,2.4561152160640154d-12,7.421365075757354d-12]],$
                 SENS_FILC: getenv('XIDL_DIR')+'HST/WFC3/G280/wfc3_abscal_UVg280_-1st_sensTV3.fits'$
                 }
     end
     
     2: begin
        struct = { $
                 READNO: 3.3,$
                 BEAMA: [-400L, 215],$
                 DYDX_ORDER_A:6L,$
                 DYDX_A: [[165.8292581254822d,-0.0017430941231037314,0.004190967371359163,$
                           7.59235690687922d-8,-4.799279736489624d-8,-2.2004234234105673d-7],$
                          [0.011329620886157242d,-3.7130183285001537d-6,-5.617240044436743d-6,$
                           1.443350486490394d-10,4.682982445817497d-10,-2.6447650909722543d-10],$
                          [0.00035264609795120246d,-7.408594874623914d-9,-2.9116571386002652d-8,$
                           2.0097801375431584d-12,-2.553651735835842d-12,1.151679979712031d-11],$
                          [2.441564618087794d-6,1.0837407637355353d-11,-1.1038671416977504d-10,$
                           1.0010953591602442d-14,-1.6198656708892635d-14,3.585083189192435d-14],$
                          [1.0657239033559628d-8,-1.1978178096619563d-13,5.257325236551057d-13,$
                           -5.2428993368408627d-17,1.2585855469454978d-16,-3.5340045042355594d-16],$
                          [2.3254146148411666d-11,-1.0819429215096503d-15,2.7207846994872573d-15,$
                           -3.680893302637254d-19,8.813537319288154d-19,-1.7578924823550215d-18],$
                          [1.961065359285038d-14,-1.5436874196262055d-18,2.9796117773012048d-18,$
                           -5.140747607914649d-22,1.2390045684537149d-21,-2.089896211472153d-21]],$
                 XOFF_A: -150L,$
                 YOFF_A: 0L,$
                 XOFF_A2: 0L,$
                 YOFF_A2: 0L,$
                 DISP_ORDER_A:4L,$
                 DLDP_A: [[3569.985303781074d,0.05037348946990385,-0.019729638983668776],$
                          [-14.01123606786801d,-0.00026605332024976327,0.000143453628992614],$
                          [0.00532475340715845d,-2.8506004465458117d-7,-1.0220963845208916d-7],$
                          [0.00002832445054453313d,2.2356093628019544d-10,-4.23231216744567d-10],$
                          [4.7628507125190326d-8,2.9618253310343713d-12,-5.436895839636378d-13]],$
                 SENS_FILA: getenv('XIDL_DIR')+'HST/WFC3/G280/wfc3_abscal_UVg280_1st_sensTV3.fits',$
                 BEAMC: [-60L, 560],$
                 DYDX_ORDER_C:6L,$
                 DYDX_C: [[152.11429830237952d,-0.0022862552020068557,0.002274662249920308,$
                           8.072502045187618d-8,4.453373655067323d-8,-3.3094365838784713d-7],$
                          [-0.16746161634806486d,-0.000017824117269031726,2.72972894868618d-7,$
                           6.31593728694673d-9,-5.14866092097925d-10,-3.907970452627599d-9],$
                          [0.001717390508845745d,-5.135728903825813d-8,-2.2385797776241416d-7,$
                           -2.5811617259434942d-11,-6.890287043425549d-12,1.7116449562705468d-10],$
                          [-0.000018438850160316978d,7.843329756232926d-9,1.60472441176438d-9,$
                           -1.6476247587062665d-12,3.3205776274835525d-13,-1.751354822952019d-12],$
                          [1.0682732198064177d-7,-7.68575185796111d-11,-3.0846554347864725d-12,$
                           1.849073743906215d-14,-2.343988785559118d-15,7.124679007238576d-15],$
                          [-3.007001096601402d-10,2.768320045849178d-13,-3.1871582190076373d-15,$
                           -7.063948023352568d-17,6.101837538926873d-18,-1.2141929853655968d-17],$
                          [3.297778161402249d-13,-3.497025519744447d-16,9.585670385375236d-18,$
                           9.277242571222464d-20,-5.329274605957512d-21,7.132195335787529d-21]],$
                 XOFF_C: 300L,$
                 YOFF_C: 0L,$
                 XOFF_C2: 0L,$
                 YOFF_C2: 0L,$
                 DISP_ORDER_C:4L,$
                 DLDP_C: [[2922.080437251009d,0.04561954461101349,-0.04601844677589647],$
                          [15.408739103272021d,0.00014214831922918327,-0.0001381880477541732],$
                          [-0.004050070853457972d,2.4420427552298257d-7,2.1566951837861292d-7],$
                          [0.000011364871371530895d,-5.306338820129571d-10,-1.9566233251610045d-9],$
                          [-1.2691664599528713d-8,7.992180218683699d-13,3.96330713195308d-12]],$
                 SENS_FILC: getenv('XIDL_DIR')+'HST/WFC3/G280/wfc3_abscal_UVg280_-1st_sensTV3.fits'$
                 }
     end
     3: begin
        struct = { $
                 READNO: 3.1, $ ; electrons
                 ;;BEAM A
                 BEAMA: [-280L,10L], $
                 DYDX_A_0:  0.0, $	
                 DYDX_A_1: 5.41282E-01, $  ;; Values from November 2010
                 DYDX_A_2: 5.28737E-03 , $
                 DYDX_A_3: 2.89442E-05 , $
                 DYDX_A_4: 8.76667E-08 , $
                 DYDX_A_5: 1.10904E-10, $
                 DYDX_ORDER_A: 5L, $
                 DYDX_A: [0.0,5.41282E-01,5.28737E-03,2.89442E-05,8.76667E-08,1.10904E-10], $
                 XOFF_A:  0.0, $
                 YOFF_A: 1.91246E+02, $
                 XOFF_A2: 0, $             ; KLUDGE OFFSET
                 YOFF_A2: 0, $             ;KLUDGE OFFSET
                 DLDP_A_0:  1.70511E+03, $  ;; Values from November 2010  
                 DLDP_A_1: -8.58640E+00, $
                 DLDP_A_2:  5.23899E-02, $
                 DLDP_A_3:  2.17713E-04, $  
                 DLDP_A_4:  3.43804E-07, $
                 DISP_ORDER_A: 4L, $
                 DLDP_A: [1.70511E+03,-8.58640E+00,5.23899E-02,2.17713E-04,3.43804E-07], $
                 ;; BEAM B
                 BEAMB: [90L,115L], $
                 DYDX_B_0:  0.20708362, $
                 DYDX_B_1:  1.6027558, $
                 XOFF_B: 0, $
                 XOFF_B2: 4, $
                 YOFF_B: 0, $
                 YOFF_B2: 8, $
                 ;;BEAM C
                 BEAMC: [225L,480L], $
                 DYDX_C_0: 0.0, $	
                 DYDX_C_1: -8.1558871, $	
                 DYDX_C_2:  0.031526679, $	
                 DYDX_C_3: -5.4800719e-05, $
                 DYDX_C_4:  3.5737877e-08, $
                 XOFF_C:  0, $
                 XOFF_C2:  -3, $
                 YOFF_C:  950.05922, $
                 YOFF_C2:  -1, $
                 DLDP_C_0:  -4.33783E+05, $
                 DLDP_C_1:   1.75512E+03, $
                 DLDP_C_2:  -2.68146E+00, $
                 DLDP_C_3:   1.83546E-03, $
                 DLDP_C_4:  -4.70866E-07, $
                 ;;sensitivity 
;             sensawave: sensa.wavelength, $
;             sensaflux: sensa.sensitivity, $
;             senscwave: sensc.wavelength, $
;             senscflux: sensc.sensitivity, $
                 ;;qso templates
;             sdss_templatewave: sdsswave, $
;             sdss_templateflux: sdssflux, $
;             zheng_templatewave: zhengwave, $
;             zheng_templateflux: zhengflux, $
             ;;trace polynomials
                 tracea_poly: [0.,-0.0123543,3.45339e-6], $
                 tracec_poly:[0.,-0.0102587,3.48597e-5], $
                 sigmaa_poly: [1.2287,0.00085121,-2.07422e-05,5.87603e-08] $
                 }
     end
     else: begin
        print, 'wfc3_g280_mkcalibstrct: Assign the correct chip value!'
        stop
     end
  endcase
  
  if keyword_set(AXE1) then begin ;; First set of AXE team values
     struct.DYDX_A_1=  5.30394E-01 
     struct.DYDX_A_2=  4.97180E-03	
     struct.DYDX_A_3=  2.51954E-05
     struct.DYDX_A_4=  6.84991E-08
     struct.DYDX_A_5=  7.60109E-11
     struct.YOFF_A= 1.91133E+02
     ;; Wavelengths
     struct.DLDP_A_0=  1.68368E+03 
     struct.DLDP_A_1= -9.66614E+00
     struct.DLDP_A_2= 3.65270E-02
     struct.DLDP_A_3= 1.29000E-04
     struct.DLDP_A_4=  1.76563E-07
  endif
  
  return, struct
end
